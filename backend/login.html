<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Saathi TV - Secure Login</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/secure-login.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta name="theme-color" content="#FF6B35">
    <meta name="description" content="Join Saathi TV - Secure video chat platform. Create account or login to connect with people worldwide.">
</head>
<body>
    <div class="secure-login-container">
        <!-- Background Video/Animation -->
        <div class="login-background">
            <div class="background-overlay"></div>
            <div class="floating-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
        </div>

        <!-- Main Login Card -->
        <div class="login-main-card">
            <!-- Left Side - Branding -->
            <div class="login-branding">
                <div class="brand-logo">
                    <img src="assets/saathi-tv-logo-new.svg" alt="Saathi TV" class="brand-logo-img">
                    <h1 class="brand-title">Saathi TV</h1>
                </div>
                <div class="brand-description">
                    <h2>Become a Saathi TV member!</h2>
                    <p>Connect with millions of people worldwide through secure video chat</p>
                    <div class="online-counter">
                        <div class="online-indicator"></div>
                        <span class="online-text">450,504 users online</span>
                    </div>
                </div>
                <div class="security-badges">
                    <div class="security-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>Secure & Encrypted</span>
                    </div>
                    <div class="security-badge">
                        <i class="fas fa-user-shield"></i>
                        <span>Privacy Protected</span>
                    </div>
                    <div class="security-badge">
                        <i class="fas fa-lock"></i>
                        <span>Safe Environment</span>
                    </div>
                </div>
            </div>

            <!-- Right Side - Login Form -->
            <div class="login-form-section">
                <div class="form-header">
                    <h3 id="formTitle">Join Saathi TV</h3>
                    <p id="formSubtitle">Create your account to start chatting</p>
                </div>

                <!-- Social Login Buttons (Firebase) -->
                <div class="social-login-buttons">
                    <button type="button" id="googleLogin" class="social-btn google-btn">
                        <i class="fab fa-google"></i>
                        <span>Continue with Google</span>
                    </button>
                </div>

                <!-- Age Confirmation -->
                <div class="age-confirmation">
                    <label class="age-checkbox">
                        <input type="checkbox" id="ageConfirm" required checked>
                        <span class="checkmark"></span>
                        <span class="age-text">I confirm that I am at least 18 years old.</span>
                    </label>
                    <p class="terms-text">
                        I accept <a href="#" onclick="showTerms()">User Agreement</a>.
                    </p>
                </div>

                <!-- Alternative Login Methods -->
                <div class="alternative-login">
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <button type="button" class="email-login-btn" onclick="showEmailLogin()">
                        <i class="fas fa-envelope"></i>
                        <span>Login with Email</span>
                    </button>
                    
                </div>

                <!-- Security Features -->
                <div class="security-features">
                    <div class="security-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>End-to-end encryption</span>
                    </div>
                    <div class="security-item">
                        <i class="fas fa-eye-slash"></i>
                        <span>No data stored</span>
                    </div>
                    <div class="security-item">
                        <i class="fas fa-ban"></i>
                        <span>Report & block features</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Login Modal -->
        <div id="emailLoginModal" class="login-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Login with Email</h3>
                    <button class="close-modal" onclick="closeEmailLogin()">&times;</button>
                </div>
                
                <form id="emailLoginForm" class="email-login-form">
                    <div class="form-group">
                        <div class="input-container">
                            <input type="email" id="loginEmail" name="email" required>
                            <label for="loginEmail">Email Address</label>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-container">
                            <input type="password" id="loginPassword" name="password" required>
                            <label for="loginPassword">Password</label>
                            <i class="fas fa-lock input-icon"></i>
                            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-options">
                        <label class="remember-checkbox">
                            <input type="checkbox" id="rememberMe" name="rememberMe">
                            <span class="checkmark"></span>
                            <span>Remember me</span>
                        </label>
                        <a href="#" class="forgot-link" onclick="showForgotPassword()">Forgot Password?</a>
                    </div>

                    <button type="submit" class="submit-btn">
                        <span class="btn-text">Sign In</span>
                        <div class="btn-loader" style="display: none;"></div>
                    </button>
                </form>

                <div class="modal-footer">
                    <p>Don't have an account? <a href="#" onclick="showSignupModal()">Create Account</a></p>
                </div>
            </div>
        </div>

        <!-- Signup Modal -->
        <div id="signupModal" class="login-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create Account</h3>
                    <button class="close-modal" onclick="closeSignupModal()">&times;</button>
                </div>
                
                <form id="emailSignupForm" class="signup-form">
                    <div class="form-group">
                        <div class="input-container">
                            <input type="text" id="signupName" name="name" required>
                            <label for="signupName">Full Name</label>
                            <i class="fas fa-user input-icon"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-container">
                            <input type="email" id="signupEmail" name="email" required>
                            <label for="signupEmail">Email Address</label>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-container">
                            <input type="password" id="signupPassword" name="password" required minlength="8">
                            <label for="signupPassword">Password (min 8 characters)</label>
                            <i class="fas fa-lock input-icon"></i>
                            <button type="button" class="password-toggle" onclick="togglePassword('signupPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-container">
                            <input type="password" id="confirmPassword" name="confirmPassword" required>
                            <label for="confirmPassword">Confirm Password</label>
                            <i class="fas fa-lock input-icon"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-container">
                            <select id="signupGender" name="gender" required>
                                <option value="">Choose Gender</option>
                                <option value="male">👨 Male</option>
                                <option value="female">👩 Female</option>
                                <option value="other">🏳️‍⚧️ Other</option>
                                <option value="prefer-not-to-say">🤐 Prefer not to say</option>
                            </select>
                            <label for="signupGender">Gender</label>
                            <i class="fas fa-venus-mars input-icon"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-container">
                            <select id="signupCountry" name="country" required>
                                <option value="">Select Country</option>
                                <option value="IN">🇮🇳 India</option>
                                <option value="US">🇺🇸 United States</option>
                                <option value="UK">🇬🇧 United Kingdom</option>
                                <option value="CA">🇨🇦 Canada</option>
                                <option value="AU">🇦🇺 Australia</option>
                            </select>
                            <label for="signupCountry">Country</label>
                            <i class="fas fa-globe input-icon"></i>
                        </div>
                    </div>

                    <div class="terms-agreement">
                        <label class="terms-checkbox">
                            <input type="checkbox" id="agreeTerms" required>
                            <span class="checkmark"></span>
                            <span>I agree to the <a href="#" onclick="showTerms()">Terms of Service</a> and <a href="#" onclick="showPrivacy()">Privacy Policy</a></span>
                        </label>
                    </div>

                    <button type="submit" class="submit-btn">
                        <span class="btn-text">Create Account</span>
                        <div class="btn-loader" style="display: none;"></div>
                    </button>
                </form>

                <div class="modal-footer">
                    <p>Already have an account? <a href="#" onclick="showEmailLogin()">Sign In</a></p>
                </div>
            </div>
        </div>
        </div>

        <!-- Features Preview -->
        <div class="features-preview">
            <h3>Why Choose Saathi TV?</h3>
            <div class="preview-features">
                <div class="preview-feature">
                    <div class="preview-icon">🎥</div>
                    <span>Free HD Video Chat</span>
                </div>
                <div class="preview-feature">
                    <div class="preview-icon">🌍</div>
                    <span>Global Community</span>
                </div>
                <div class="preview-feature">
                    <div class="preview-icon">🔒</div>
                    <span>Safe & Secure</span>
                </div>
                <div class="preview-feature">
                    <div class="preview-icon">📱</div>
                    <span>Mobile Friendly</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Password</h2>
                <span class="close" onclick="closeForgotPassword()">&times;</span>
            </div>
            <form onsubmit="handleForgotPassword(event)">
                <div class="form-group">
                    <div class="input-container">
                        <input type="email" id="resetEmail" required>
                        <label for="resetEmail">Enter your email address</label>
                        <div class="input-icon">📧</div>
                    </div>
                </div>
                <button type="submit" class="reset-btn">Send Reset Link</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK v9 (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAXrbJQJhjfwp4ugkp2dAckoXodtPqH73E",
            authDomain: "saathi-5fa22.firebaseapp.com",
            databaseURL: "https://saathi-5fa22-default-rtdb.firebaseio.com",
            projectId: "saathi-5fa22",
            storageBucket: "saathi-5fa22.firebasestorage.app",
            messagingSenderId: "189814220535",
            appId: "1:189814220535:web:c22305089ff101282b95f2"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        console.log('🔥 Firebase initialized on login page!');
        
        // Simple login functions
        async function handleGoogleLogin() {
            try {
                console.log('🔍 Starting Google login...');
                
                // Check if Firebase is loaded
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase is not loaded');
                }
                
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                const result = await firebase.auth().signInWithPopup(provider);
                
                console.log('✅ Google login successful:', result.user.email);
                alert('Login successful! Redirecting...');
                
                // Redirect to main page
                window.location.href = 'index.html';
            } catch (error) {
                console.error('❌ Google login error:', error);
                
                // More specific error messages
                let errorMessage = 'Login failed: ';
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage += 'Login popup was closed. Please try again.';
                } else if (error.code === 'auth/popup-blocked') {
                    errorMessage += 'Popup was blocked by browser. Please allow popups for this site.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage += 'Network error. Please check your internet connection.';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
            }
        }
        
        async function handleEmailLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            // Show loading state
            const submitBtn = document.querySelector('#emailLoginForm .submit-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoader = submitBtn.querySelector('.btn-loader');
            
            if (btnText && btnLoader) {
                btnText.style.display = 'none';
                btnLoader.style.display = 'block';
                submitBtn.disabled = true;
            }
            
            try {
                console.log('🔍 Starting email login for:', email);
                const result = await firebase.auth().signInWithEmailAndPassword(email, password);
                
                console.log('✅ Email login successful:', result.user.email);
                alert('Login successful! Redirecting...');
                
                // Redirect to main page
                window.location.href = 'index.html';
            } catch (error) {
                console.error('❌ Email login error:', error);
                
                // More specific error messages
                let errorMessage = 'Login failed: ';
                if (error.code === 'auth/user-not-found') {
                    errorMessage += 'No account found with this email. Please sign up first.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage += 'Incorrect password. Please try again.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage += 'Invalid email address format.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage += 'Too many failed attempts. Please try again later.';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
            } finally {
                // Reset button state
                if (btnText && btnLoader) {
                    btnText.style.display = 'block';
                    btnLoader.style.display = 'none';
                    submitBtn.disabled = false;
                }
            }
        }
        
        async function handleEmailSignup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const gender = document.getElementById('signupGender').value;
            const country = document.getElementById('signupCountry').value;
            
            if (!name || !email || !password || !confirmPassword || !gender) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            try {
                console.log('🔍 Starting email signup...');
                const result = await firebase.auth().createUserWithEmailAndPassword(email, password);
                await result.user.updateProfile({ displayName: name });
                
                console.log('✅ Email signup successful:', result.user.email);
                alert('Account created successfully! Redirecting...');
                
                // Redirect to main page
                window.location.href = 'index.html';
            } catch (error) {
                console.error('❌ Email signup error:', error);
                
                // More specific error messages
                let errorMessage = 'Signup failed: ';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage += 'An account with this email already exists. Please sign in instead.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage += 'Password is too weak. Please choose a stronger password.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage += 'Invalid email address format.';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
            }
        }
        
        // Missing utility functions
        window.togglePassword = function(inputId) {
            const input = document.getElementById(inputId);
            const button = input.parentElement.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                button.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                button.className = 'fas fa-eye';
            }
        };
        
        window.showTerms = function() {
            alert('Terms of Service: By using Saathi TV, you agree to our community guidelines and safety policies. Please be respectful and follow our community standards.');
        };
        
        window.showPrivacy = function() {
            alert('Privacy Policy: We protect your privacy and do not store personal conversations. Your data is encrypted and secure.');
        };
        
        window.showForgotPassword = function() {
            document.getElementById('forgotPasswordModal').style.display = 'flex';
        };
        
        window.closeForgotPassword = function() {
            document.getElementById('forgotPasswordModal').style.display = 'none';
        };
        
        window.handleForgotPassword = async function(event) {
            event.preventDefault();
            const email = document.getElementById('resetEmail').value.trim();
            
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            try {
                await firebase.auth().sendPasswordResetEmail(email);
                alert('Password reset link sent to: ' + email);
                closeForgotPassword();
                document.getElementById('resetEmail').value = '';
            } catch (error) {
                console.error('❌ Password reset error:', error);
                let errorMessage = 'Reset failed: ';
                if (error.code === 'auth/user-not-found') {
                    errorMessage += 'No account found with this email address.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage += 'Invalid email address format.';
                } else {
                    errorMessage += error.message;
                }
                alert(errorMessage);
            }
        };
        
        // Add event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📱 Login page loaded, setting up event listeners...');
            
            // Google login button
            const googleBtn = document.getElementById('googleLogin');
            if (googleBtn) {
                googleBtn.addEventListener('click', handleGoogleLogin);
                console.log('✅ Google login button connected');
            }
            
            // Email login form
            const emailForm = document.getElementById('emailLoginForm');
            if (emailForm) {
                emailForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleEmailLogin();
                });
                console.log('✅ Email login form connected');
            }
            
            // Email signup form
            const signupForm = document.getElementById('emailSignupForm');
            if (signupForm) {
                signupForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleEmailSignup();
                });
                console.log('✅ Email signup form connected');
            }
            
            // Modal functions
            window.showEmailLogin = function() {
                document.getElementById('emailLoginModal').style.display = 'flex';
            };
            
            window.closeEmailLogin = function() {
                document.getElementById('emailLoginModal').style.display = 'none';
            };
            
            window.showSignupModal = function() {
                document.getElementById('signupModal').style.display = 'flex';
            };
            
            window.closeSignupModal = function() {
                document.getElementById('signupModal').style.display = 'none';
            };
            
            console.log('🎉 All login functions ready!');
        });
    </script>
</body>
</html>
